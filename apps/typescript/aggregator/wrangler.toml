name = "aggregator"
main = "src/aggworker.ts"
compatibility_date = "2026-01-08"
account_id = "513f37da8020ee565269c199ff8bb52f"

# Note: Each environment must explicitly define its own vars
# Top-level vars are NOT inherited by environments

# Note: Each environment must explicitly define its own vars
# Top-level vars are NOT inherited by environments

[env.dev]
name = "aggregator-dev"
triggers = { crons = ["1-59/5 * * * *"] }

[env.dev.vars]
ENV_NAME = "DEV"
JOB_NAME = "agg-master"
TRIGGER = "cron"
MAX_TASKS_PER_RUN = "20"
MAX_WINDOWS_PER_TASK = "100"
RUNNING_STALE_SECONDS = "900"
AUTO_DISABLE_HARD_FAILS = "3"
AGG_DERIVATION_VERSION = "1"
LOG_LEVEL = "INFO"

[env.test]
name = "aggregator-test"
triggers = { crons = ["1-59/5 * * * *"] }

[env.test.vars]
ENV_NAME = "TEST"
JOB_NAME = "agg-master"
TRIGGER = "cron"
MAX_TASKS_PER_RUN = "20"
MAX_WINDOWS_PER_TASK = "100"
RUNNING_STALE_SECONDS = "900"
AUTO_DISABLE_HARD_FAILS = "3"
AGG_DERIVATION_VERSION = "1"
LOG_LEVEL = "INFO"

[env.stage]
name = "aggregator-stage"
triggers = { crons = ["1-59/5 * * * *"] }

[env.stage.vars]
ENV_NAME = "STAGE"
JOB_NAME = "agg-master"
TRIGGER = "cron"
MAX_TASKS_PER_RUN = "20"
MAX_WINDOWS_PER_TASK = "100"
RUNNING_STALE_SECONDS = "900"
AUTO_DISABLE_HARD_FAILS = "3"
AGG_DERIVATION_VERSION = "1"
LOG_LEVEL = "WARN"

[env.prod]
name = "aggregator-prod"
triggers = { crons = ["1-59/5 * * * *"] }

[env.prod.vars]
ENV_NAME = "PROD"
JOB_NAME = "agg-master"
TRIGGER = "cron"
MAX_TASKS_PER_RUN = "20"
MAX_WINDOWS_PER_TASK = "100"
RUNNING_STALE_SECONDS = "900"
AUTO_DISABLE_HARD_FAILS = "3"
AGG_DERIVATION_VERSION = "1"
LOG_LEVEL = "WARN"

